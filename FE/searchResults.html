<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả tìm kiếm</title>
    <link rel="stylesheet" href="../FE/css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <!-- Header -->
    <div id="header"></div>

    <div class="container mt-4">
        <h3 class="text-center">Kết quả tìm kiếm</h3>
        <div class="table-container">
            <table class="table table-bordered table-striped text-center">
                <thead class="table-dark">
                    <tr>
                        <th>Tên giao dịch</th>
                        <th>Danh mục</th>
                        <th>Loại danh mục</th>
                        <th>Số tiền</th>
                        <th>Ngày</th>
                        <th>Chức năng</th>
                    </tr>
                </thead>
                <tbody id="searchResultsTableBody">
                    <!-- Kết quả tìm kiếm sẽ được hiển thị ở đây -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer"></div>

    <script>
        // Tải header và footer từ các tệp HTML riêng biệt
        document.addEventListener("DOMContentLoaded", function () {
            // Tải header
            fetch("../FE/partials/header.html")
                .then(response => response.text())
                .then(data => {
                    document.getElementById("header").innerHTML = data;
                });

            // Tải footer
            fetch("../FE/partials/footer.html")
                .then(response => response.text())
                .then(data => {
                    document.getElementById("footer").innerHTML = data;
                });
            
            // Lấy dữ liệu tìm kiếm từ URL
            const params = new URLSearchParams(window.location.search);
            const searchQuery = params.get("query");
            const transactions = JSON.parse(sessionStorage.getItem("transactions")) || [];

            // Lọc kết quả theo từ khóa tìm kiếm
            const results = transactions.filter(transaction =>
                transaction.name.toLowerCase().includes(searchQuery.toLowerCase())
            );

            // Hiển thị kết quả trong bảng
            const tableBody = document.getElementById("searchResultsTableBody");
            if (results.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" style="color: red;">Không tìm thấy kết quả nào!</td></tr>`;
            } else {
                results.forEach(transaction => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${transaction.name}</td>
                        <td>${transaction.category_id.name}</td>
                        <td>${transaction.type === "expense" ? "Chi tiêu" : "Thu nhập"}</td>
                        <td>${parseFloat(transaction.amount).toLocaleString()} đ</td>
                        <td>${new Date(transaction.date).toLocaleDateString("vi-VN")}</td>
                        <td>
                            <button onclick="editSetup('${transaction._id}')" class="btn btn-warning btn-sm me-1 edit-btn" data-bs-toggle="modal" data-bs-target="#editTransactionModal">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                            <button onclick="deleteTransaction('${transaction._id}')" class="btn btn-danger btn-sm">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        });
    </script>
</body>
</html>